<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.shoesing.item.model.mapper.ItemMapper">
	
	<resultMap type="Item" id="item_rm">
		
		<id property="itemNo" column="ITEM_NO"/>
		
		<collection property="sizeList"
					select="selectSizeList"
					column="ITEM_NO"
					javaType="java.util.ArrayList"
					ofType="Size"
		/>
		
		
	</resultMap>
	
	<select id="selectAll">
		SELECT ITEM_NO, ITEM_NAME, ITEM_PRICE, (IMG_PATH || IMG_RENAME) THUMBNAIL
		FROM "ITEM"
		LEFT JOIN "ITEM_IMG"
		USING (ITEM_NO)
		WHERE ITEM_COUNT > 0
		ORDER BY 
		
		<!-- 기본 정렬 -->
		<if test="sortNo == 0">
			ITEM_NO
		</if>
		
		<!-- 기본 역순 정렬 -->
		<if test="sortNo == 1">
			ITEM_NO DESC
		</if>
		
		<!-- 가격순 정렬 -->
		<if test="sortNo == 2">
			ITEM_PRICE, ITEM_NO
		</if>
		
		<!-- 가격 역순 정렬 -->
		<if test="sortNo == 3">
			ITEM_PRICE DESC, ITEM_NO
		</if>
		
		<!-- 이름순 정렬 -->
		<if test="sortNo == 4">
			ITEM_NAME, ITEM_NO
		</if>
		
		<!-- 이름 역순 정렬 -->
		<if test="sortNo == 5">
			ITEM_NAME DESC, ITEM_NO
		</if>
		
		<!-- 리뷰순 정렬 (아직 비활성화)
		<if test="${sortNo == 0}">
			
		</if> -->
	</select>
	
	<!-- 상품 총 개수  -->
	<select id="getListCount">
		SELECT COUNT(*) 
		FROM "ITEM"
	</select>
	
	<select id="selectOne" resultMap="item_rm">
		SELECT ITEM_NO, ITEM_NAME, ITEM_PRICE, ITEM_UPLOAD_DATE, 
				ITEM_BRAND, ITEM_INFO, CATEGORY_NO, 
				(SELECT IMG_PATH || IMG_RENAME
				 FROM "ITEM_IMG"
				 WHERE ITEM_NO = #{itemNo}
				 AND   IMG_ORDER = 0) THUMBNAIL
		FROM "ITEM"
		WHERE ITEM_NO = ${itemNo}
	</select>
	
	<!-- 해당 상품 사이즈별 재고 검색 -->
	<select id="selectSizeList" resultType="Size">
		SELECT SIZE_NO, ITEM_NO, SIZE_VAL, SIZE_STOCK
		FROM "STOCK"
		JOIN "SIZE" USING(SIZE_NO)
		WHERE SIZE_STOCK > 0
		AND ITEM_NO = ${itemNo}
	</select>
	
</mapper>











