<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.shoesing.order.model.mapper.OrderMapper">

	<select id="selectDetailList">
		SELECT ITEM_STOCK_NO, ITEM_NO, ITEM_NAME, SIZE_NO, SIZE_VAL, ITEM_PRICE
		FROM "STOCK"
		JOIN "ITEM" USING(ITEM_NO)
		JOIN "SIZE" USING(SIZE_NO)
		WHERE ITEM_STOCK_NO IN 
			<foreach collection="list" item="i" open="(" close=")" separator=", " >
				#{i}
			</foreach>
	</select>
	
	<!-- 주문목록 생성 -->
	<insert id="insertOrder" useGeneratedKeys="true" keyProperty="orderNo" keyColumn="ORDER_NO">
	
		<selectKey order="BEFORE" resultType="_int" keyProperty="orderNo">
			SELECT SEQ_ORDER_NO.NEXTVAL FROM DUAL
		</selectKey>
	
		INSERT INTO "USER_ORDER"
		VALUES(
			#{orderNo},
			DEFAULT,
			#{orderAddress},
			DEFAULT,
			#{orderPrice},
			
			<if test="userNo == 0">#{orderNo}</if>
			<if test="userNo != 0">#{userNo}</if>
		)
	</insert>
	
	<!-- 세부 주문목록 생성 -->
	<insert id="insertOrderDetail" >
	
		INSERT INTO "ORDER_DETAIL"
			<foreach collection="itemStockNoList" item="i" open="(" close=")" separator=" UNION ">
				SELECT NEXT_ORDER_DETAIL_NO(), #{orderNo}, #{i.itemStockNo}, #{i.orderItemCount}
				FROM DUAL
			</foreach>	
		
	</insert>
	
</mapper>